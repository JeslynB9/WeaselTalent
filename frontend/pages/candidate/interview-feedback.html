<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Feedback</title>

    <link rel="stylesheet" href="../../css/components/navbar.css">
    <link rel="stylesheet" href="../../css/base/style.css">
    <link rel="stylesheet" href="../../css/pages/interviews.css">

    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        .star { font-size: 30px; color: #ccc; margin-right:6px; }
        .star.filled { color: #f5b400; text-shadow: 0 1px 0 rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<nav>
    <div class="left-nav">
        <img src="../../assets/images/logo.png" alt="Logo">
        <input type="text" placeholder="Search">
    </div>
    <div class="links">
        <a href="../../pages/candidate/home.html">Home</a>
        <a href="../../pages/candidate/jobs.html">Jobs</a>
        <a href="../../pages/candidate/assessments.html">Assessments</a>
        <a href="../../pages/candidate/interviews.html">Interviews</a>
        <a href="../../pages/shared/notifications.html">Notifications</a>
        <a href="../../pages/shared/profile.html">Me</a>
    </div>
</nav>

<div class="container">

    <!-- LEFT COLUMN -->
    <div id="profile-column"></div>

    <!-- RIGHT COLUMN -->
    <div class="content-column">
        <div class="card">
            <div class="card-header">
                <h3>Positives</h3>
            </div>
            <div id="positives" class="comment"></div>
            </div>
        

        <div class="card">
            <div class="card-header">
                <h3>Negatives</h3>
            </div>
            <div id="negatives" class="comment"></div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Interview Rating</h3>
                <div class="rating readonly">
                </div>
            </div>
        </div>



    </div>
</div>


<script src="../../js/api-config.js"></script>
<script src="../../js/components/profile-column.js"></script>
<script>
// Read interview_id from query string and fetch notes
async function initFeedback() {
    const params = new URLSearchParams(window.location.search);
    const interviewId = params.get('interview_id');
    if (!interviewId) {
        // document.getElementById('positives').textContent = 'No interview selected.';
        return;
    }

    try {
        const res = await fetch(`${API_BASE.replace(/\/$/, '')}/interviews/${interviewId}/notes`);
        if (!res.ok) throw new Error('Failed to load notes');
        const data = await res.json();
        const notes = data.notes || '';
        const score = data.fit_score || 0;
        const decision = data.decision || '';

        // Simple split: assume notes contains positives/negatives separated by '\n\n' (best-effort)
        const parts = notes.split('\n\n');
        document.getElementById('positives').textContent = parts[0] || '';
        document.getElementById('negatives').textContent = parts[1] || '';

        // render rating (map stored fit_score to 1-5 scale)
        let displayScore = 0;
        if (data.fit_score) {
            const raw = Number(data.fit_score);
            displayScore = raw > 5 ? Math.round(raw / 2) : raw; // map 6-10 -> 3-5
            displayScore = Math.max(0, Math.min(5, displayScore));
        }
        const ratingEl = document.getElementById('rating');
        ratingEl.innerHTML = Array.from({length:5}).map((_,i)=> i < displayScore ? '<span class="star filled">★</span>' : '<span class="star">★</span>').join('');

    } catch (err) {
        console.error(err);
        document.getElementById('positives').textContent = 'Failed to load feedback.';
    }
}
document.addEventListener('DOMContentLoaded', initFeedback);
</script>
</body>
</html>
